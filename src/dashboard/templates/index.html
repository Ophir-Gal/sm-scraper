<!DOCTYPE html>
<meta charset="utf-8" />

<head>
<title>Reddit Police Brutality Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://d3js.org/d3.v6.min.js"></script>
<script src="https://unpkg.com/d3-simple-slider"></script>
<link type="text/css" rel="stylesheet"
        href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="{{ url_for('static',filename='css/style.css') }}">
<link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico')
}}">
<script src="{{ url_for('static', filename='js/util.js') }}"></script>
<script src="{{ url_for('static', filename='js/filter.js') }}"></script>
<script src="{{ url_for('static', filename='js/date-range-input.js') }}"></script>
<script src="{{ url_for('static', filename='js/keyword-input.js') }}"></script>
<script src="{{ url_for('static', filename='js/jurisdiction-input.js') }}"></script>
<script src="{{ url_for('static', filename='js/source-input.js') }}"></script>
<script src="{{ url_for('static', filename='js/pills.js') }}"></script>
<script src="{{ url_for('static', filename='js/post-list.js') }}"></script>
<script src="{{ url_for('static', filename='js/times-vis.js') }}"></script>
<script src="{{ url_for('static', filename='js/words-vis.js') }}"></script>
<script src="{{ url_for('static', filename='js/stats.js') }}"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.0.1/spin.min.js'></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
</head>

<body  class="bg-light">
  <div class="container-fluid px-4 h-100">
  <div class="mb-4 mt-4">
    <h3>CMSC828D: Reddit Police Brutality Activity Dashboard</h3>
  </div>

  <div class="row">
    <div class="col-2 container-fluid h-100">
      <div class="col-title">
        Query Filters
      </div>
      <div class="mb-2 p-2 pb-4 rounded shadow-1-strong bg-white list-item" id="query-box">        
        
        <div class="mb-4">
          <div id="date-range-slider">Date range</div>
          <div>
            <button id="1D-button" type="button" class="btn btn-sm btn-light" onclick="dateRangeSelect('1D')">1D</button>
            <button id="1W-button" type="button" class="btn btn-sm btn-primary" onclick="dateRangeSelect('1W')">1W</button>
            <button id="1M-button" type="button" class="btn btn-sm btn-light" onclick="dateRangeSelect('1M')">1M</button>
            <button id="3M-button" type="button" class="btn btn-sm btn-light" onclick="dateRangeSelect('3M')">3M</button>
            <button id="1Y-button" type="button" class="btn btn-sm btn-light" onclick="dateRangeSelect('1Y')">1Y</button>
            <button id="All-button" type="button" class="btn btn-sm btn-light" onclick="dateRangeSelect('All')">All</button>
          </div>
        </div>
        <div class="mb-3">
          <input class="mb-1 input-width" type="text" id="keyword-input" name="keyword-input" placeholder="Keyword Input">
          <div class="overflow-auto" style="max-height: 16vh;" id="keyword-pill-list"></div>
        </div>
        <div class="mb-3">
          <input class="mb-1 input-width" type="text" id="jurisdiction-input" name="jurisdiction-input" placeholder="Jurisdiction Input">
          <div class="overflow-auto" style="max-height: 16vh;" id="jurisdiction-pill-list"></div>
        </div>
        <div class="mb-3">
          <input class="mb-1 input-width" type="text" id="source-input" name="source-input" placeholder="Source Input (Subreddits)">
          <div class="overflow-auto" style="max-height: 16vh;" id="source-pill-list"></div>
        </div>
      </div>
    </div>

    <div class="col-10 container-fluid">
      <div class="mb-4 container-fluid">
        <div class="row">
          <div class="col-3 p-0 pr-4 container-fluid h-100">
            <div class="mb-2 p-2 rounded shadow-1-strong bg-white list-item" id="stat1">
              Stat1
            </div>
          </div>
          <div class="col-3 p-0 pr-4 container-fluid h-100">
            <div class="mb-2 p-2 rounded shadow-1-strong bg-white list-item" id="stat2">
              Stat2
            </div>
          </div>
          <div class="col-3 p-0 pr-4 container-fluid h-100">
            <div class="mb-2 p-2 rounded shadow-1-strong bg-white list-item" id="stat3">
              Stat3
            </div>
          </div>
          <div class="col-3 p-0 container-fluid h-100">
            <div class="mb-2 p-2 rounded shadow-1-strong bg-white list-item" id="stat4">
              Stat4
            </div>
          </div>
          
        </div>
        
      </div>
      <div class="row">
        <div class="col-6 container-fluid" style="max-height: 65vh;">
          <div class="col-title">
            Reddit Posts
          </div>
          <div class="pl-1 pr-1 overflow-auto" id="postlist" style="max-height: 65vh;">
            
          </div>
        </div>

        <div class="col-6 container-fluid">
          <div class="col-title">
            Visualizations
          </div>
          <div class="mb-3 p-2 rounded shadow-1-strong bg-white" id="times-vis" style="height: 43%">   
          </div>
          <div class="mb-3 p-2 rounded shadow-1-strong bg-white" id="words-vis" style="height: 43%">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  var postList = [];
  var dateRangeSetting = "";
  var dateRange = {'min': Date.now(), 'max': Date.now()};
  var keywords = [];
  var jurisdictions = [];
  var sources = [];

  // Render all visualizations (the function needs to have global scope)
  function renderAll(
    stats = true,
    times_vis = true,
    words_vis = true,
    postlist = true,
    filters = {}
  ) {
    console.log("Rendering all");
    if (stats) render_stats(filters)
    if (times_vis) render_times_vis(filters)
    if (words_vis) render_words_vis(filters)
    if (postlist) renderPostList()
  }

  // event listeners
  window.addEventListener('load', renderAll)
  window.addEventListener('resize', renderAll)
  document.getElementById("keyword-input").addEventListener("keydown", function (e) {
      if (e.keyCode === 13) {
          addKeywords(e);
      }
  });
  document.getElementById("jurisdiction-input").addEventListener("keydown", function (e) {
      if (e.keyCode === 13) {
          addJurisdictions(e);
      }
  });
  document.getElementById("source-input").addEventListener("keydown", function (e) {
      if (e.keyCode === 13) {
          addSources(e);
      }
  });

  function init() {
    // presupply default filter settings
    dateRangeSetting = "1W";
    updateDateRangeButtons();
    jurisdictions.push("Washington, DC", "Baltimore, MD", "Louisville, KY");
    sources.push("police", "policebrutality");
    updateAllPills();
  }


  // initialize and renderAll
  init();
  renderAll();
  
</script>
</body>
